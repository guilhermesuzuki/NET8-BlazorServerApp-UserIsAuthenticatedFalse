@page "/counter-1"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@attribute [Authorize("CustomPolicy1")]
@rendermode InteractiveServer

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>
<p role="status">Current count: @currentCount</p>
<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>
<button @onclick="@DoSomething">Do something important</button>

<div>
    <AuthorizeView>
        <Authorized><span style="background-color:red; font-size:20px; padding: 5px;">OK, @context.User.Identity?.Name</span></Authorized>
        <NotAuthorized>NOT AUTHORIZED</NotAuthorized>
    </AuthorizeView>
</div>

@code {
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }

    [CascadingParameter] private Task<AuthenticationState>? authenticationState { get; set; }

    private async Task DoSomething()
    {
        if (authenticationState is not null)
        {
            var authState = await authenticationState;
            var user = authState?.User;

            if (user is not null)
            {
                if (user.Identity is not null && user.Identity.IsAuthenticated)
                {
                    currentCount = int.MinValue;
                }
            }
        }
    }
}
